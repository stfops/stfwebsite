"use strict";uw_wp_theme.Instagram={},uw_wp_theme.Instagram.Image=Backbone.Model.extend({}),uw_wp_theme.Instagram.Backgrounds=Backbone.Collection.extend({model:uw_wp_theme.Instagram.Image,defaults:{access_token:"201177297.d9d55d5.ca8b5f2da50f41cab37e85ae80874b3e",client_id:"d9d55d56f8814f8e83b6492803e9b773",user_id:201177297,count:40},url:function(){return"https://api.instagram.com/v1/users/"+this.defaults.user_id+"/media/recent"},initialize:function(){this.fetch({data:this.defaults,dataType:"jsonp",crossDomain:!0})},parse:function(t){return t.meta.code,t.data}}),uw_wp_theme.Instagram.View=Backbone.View.extend({last5:[-1,-1,-1,-1,-1],offLimitsImg:[],isRendered:!1,isVisible:!1,rotationInterval:!1,backgroundTiles:[],el:$("#social-wrapper"),listTemplate:_.template('<div><a href="<%= link %>"><img src="<%= image %>"/><p><%= text %></p></a></div>'),initialize:function(){_.bindAll(this,"hideOrShow","rotateBackground"),this.largeTileTemplate=_.template($("#large-background-tile").html()),this.smallTilesTemplate=_.template($("#small-background-tiles").html()),this.$list=$("#instagram"),this.collection.on("sync",this.makeListView,this),$(window).resize(this.hideOrShow)},getRandomImage:function(){var t=Math.floor(Math.random()*this.collection.models.length);return-1==_.indexOf(this.last5,t)&&-1==_.indexOf(this.off_limits_img,t)?(this.last5.pop(),this.last5.unshift(t),t):this.getRandomImage()},makeListView:function(){var t,i;this.hideOrShow();for(var e=0;e<5;e++)t=this.collection.models[e].toJSON(),i={text:uw_wp_theme.wrapHashtagsLinks(t.caption.text),link:t.link,image:t.images.standard_resolution.url},this.$list.append(this.listTemplate(i));this.$list.addClass("show")},hideOrShow:function(){768<=window.innerWidth?(this.isRendered?this.isVisible||(this.$el.show(),this.rotationInterval=setInterval(this.rotateBackground,500)):(this.render(),this.rotationInterval=setInterval(this.rotateBackground,500)),this.isVisible=!0):this.isVisible&&(this.$el.hide(),this.isVisible=!1,clearInterval(this.rotationInterval))},render:function(){for(var t,i=0;i<84;i++){var e={};if(i%2==0)t=this.getRandomImage(),e.image=this.collection.models[t].attributes.images,e.number=t,this.$el.append(this.largeTileTemplate(e));else{for(var a=[],s=0;s<4;s++){var n={};t=this.getRandomImage(),n.image=this.collection.models[t].attributes.images,n.number=t,a.push(n)}e.image=a,this.$el.append(this.smallTilesTemplate(e))}}this.isRendered=!0,this.backgroundTiles=$(".background-tile")},rotateBackground:function(){var t=this.backgroundTiles.length,i=Math.floor(Math.random()*t),e=$(this.backgroundTiles[i]);this.offLimitsImg=[];for(var a=Math.max(i-5,0),s=Math.min(i+5,t-1),n=a;n<=s;n++)this.offLimitsImg.push(Number($(this.backgroundTiles[n]).attr("data-img")));var r=this.getRandomImage(),o=this.collection.models[r].attributes.images.low_resolution.url;e.animate({opacity:.1},250,function(){e.css("background-image","url("+o+")"),e.attr("data-img",r),e.animate({opacity:1},250)})}}),$(document).ready(function(){uw_wp_theme.Instagram.backgrounds=new uw_wp_theme.Instagram.Backgrounds,uw_wp_theme.Instagram.view=new uw_wp_theme.Instagram.View({el:$("#social-wrapper"),collection:uw_wp_theme.Instagram.backgrounds})});